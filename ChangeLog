Wed Apr  7 19:35:42 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* htsearch/htsearch.cc(usage): Remove bogus -w flag.

Thu Apr  1 12:05:11 1999  Gilles Detillieux  <grdetil@scrc.umanitoba.ca>

	* htsearch/htsearch.cc(main): Apply Gabriele's patch to avoid using an
	invalid matchesperpage CGI input variable.

	* htsearch/Display.cc(display) & (setVariables): Correct any invalid
	values for matches_per_page attribute to avoid div. by 0 error.

Wed Mar 31 15:19:25 1999  Gilles Detillieux  <grdetil@scrc.umanitoba.ca>

	* htfuzzy/Synonym.cc: Fix previous fix of minor memory leak.
	(db pointer wasn't properly set)

Mon Mar 29 10:31:09 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* htsearch/Display.cc(excerpt): Added patch from Gabriele to
	improve display of excerpts--show top of description always,
	otherwise try to find the excerpt.

Sun Mar 28 19:45:02 1999  Hans-Peter Nilsson  <hp@bitrange.com>

	* htlib/HtWordType.h (HtIsWordChar): Avoid matching 0 when using
	strchr.
	(HtIsStrictWordChar): Ditto.

	* htdig/ExternalParser.cc (parse): Before got_href call, set
	hopcount of URL to that of base plus 1.
	Add URL to external parser error output.

	* htlib/URL.cc (URL(char *ref, URL &parent) ): Move call to
	constructURL call inside previous else-clause.
	(parse): Reset _normal, _signature, _user initially.
	Commence parsing, even if no "//" is found.  Do not set _normal
	here.
	(normalizePath): Call removeIndex finally.

	* htcommon/WordRecord.h (WORD_RECORD_COMPRESSED_FORMAT)
	[!NO_WORD_COUNT]: Change to "cu4".

	* htlib/HtPack.cc (htPack): Correct handling at end of code-string
	and end of encoding-byte.  Add code 'c' for often-1 unsigned ints.
	(htUnpack): Add handling of code 'c'.

Thu Mar 25 12:18:05 1999  Gilles Detillieux  <grdetil@scrc.umanitoba.ca>

	* installdir/long.html, installdir/short.html: Remove backslashes
	before quotes in HTML versions of the builtin templates.

	* Makefile.in: Add long.html & short.html to COMMONHTML list, so
	they get installed in common_dir.

Thu Mar 25 11:56:50 1999  Gilles Detillieux  <grdetil@scrc.umanitoba.ca>

	* htsearch/Display.cc(displayMatch), htcommon/defaults.cc, 
	htdoc/attrs.html, htdoc/cf_byname.html, htdoc/cf_byprog.html:
	Add date_format attribute suggested by Marc Pohl.

Thu Mar 25 09:46:07 1999  Gilles Detillieux  <grdetil@scrc.umanitoba.ca>

	* htsearch/Display.cc(displayMatch): Avoid segfault when DocAnchors
	list has too few entries for current anchor number.

Tue Mar 23 15:08:40 1999  Gilles Detillieux  <grdetil@scrc.umanitoba.ca>

	* htsearch/Display.cc(displayMatch): Fix problem when documents
	did not have descriptions.

Tue Mar 23 14:17:14 1999  Gilles Detillieux  <grdetil@scrc.umanitoba.ca>

	* htdig/PDF.cc(parseString): Use minimum_word_length instead of
	hardcoded constant.

Tue Mar 23 14:02:40 1999  Gilles Detillieux  <grdetil@scrc.umanitoba.ca>

	* htdig/HTML.cc: Fix bug where noindex_start was empty, allow case
	insensitive matching of noindex_start & noindex_end.

	* htdoc/attrs.html, htdoc/cf_byname.html, htdoc/cf_byprog.html:
	Fix inconsistencies in documentation for noindex_start & noindex_end.

Tue Mar 23 14:01:16 1999  Gilles Detillieux  <grdetil@scrc.umanitoba.ca>

	* htdig/HTML.cc: Add check for <a href=...> tag that is missing a
	closing </a> tag, terminating it at next href.

Tue Mar 23 13:57:35 1999  Gilles Detillieux  <grdetil@scrc.umanitoba.ca>

	* htdig/Document.cc: Fix check of Content-type header in readHeader(),
	correcting bug introduced Jan 10 (for PR#91), and check against
	allowed external parsers.

Tue Mar 23 13:54:35 1999  Gilles Detillieux  <grdetil@scrc.umanitoba.ca>

	* htdig/HTML.cc: More lenient comment parsing, allows extra dashes.

Tue Mar 23 12:22:53 1999  Gilles Detillieux  <grdetil@scrc.umanitoba.ca>

	* htlib/Configuration.cc(Add): Fix function to avoid infinite loop
	on some systems, which don't allow all the letters in isalnum() that
	isalpha() does, e.g. accented ones.

	* htdig/HTML.cc: Fix three reported bugs about inconsistent
	handling of space and punctuation in title, href description & head.
	Now makes destinction between tags that cause word breaks and those
	that don't, and which of the latter add space.

Tue Mar 23 12:15:48 1999  Gilles Detillieux  <grdetil@scrc.umanitoba.ca>

	* htdig/Plaintext.cc(parse): Use minimum_word_length instead of
	hardcoded constant.

Tue Mar 23 12:11:04 1999  Gilles Detillieux  <grdetil@scrc.umanitoba.ca>

	* htmerge/words.cc(mergeWords): Fix to prevent description text
	words from clobbering anchor number of merged anchor text words.

Tue Mar 23 12:02:00 1999  Gilles Detillieux  <grdetil@scrc.umanitoba.ca>

	* htsearch/Display.cc(generateStars): Add in support for use_star_image
	which was lost when template support was put in way back when.

Tue Mar 23 11:47:52 1999  Gilles Detillieux  <grdetil@scrc.umanitoba.ca>

	* Makefile.in: add missing ';' in for loops, between fi & done

Mon Mar 22 16:06:15 1999  Gilles Detillieux  <grdetil@scrc.umanitoba.ca>

	* htdig/HTML.cc: Check for presence of more than one <title> tag.

Mon Mar 22 15:32:15 1999  Gilles Detillieux  <grdetil@scrc.umanitoba.ca>

	* contrib/parse_doc.pl: Fix handling of minimum word length.

Sun Mar 21 15:19:00 1999  Hans-Peter Nilsson  <hp@bitrange.com>

	* htlib/HtPack.cc (htPack): New.
	* htlib/HtPack.h: New.
	* htsearch/parser.cc (perform_push): Unpack WordRecords using
	htUnpack.
	* htsearch/htsearch.h: Add "debug" declaration.
	* htmerge/words.cc (mergeWords): Pack WordRecords using htPack.
	* htlib/Makefile.in (OBJS): Add HtPack.o
	* htcommon/WordRecord.h: Add WORD_RECORD_COMPRESSED_FORMAT

	* htdig/HTML.cc (parse): Keep contents in String variable
	textified_contents while using its "char *".

	* htsearch/Display.cc (excerpt): Similar for head_string.

Thu Mar 18 20:01:24 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* installdir/long.html, installdir/short.html: Write out HTML
	versions of the builtin templates.

	* installdir/htdig.conf: Add commented-out template_map and
	template_name attributes to use the on-disk versions.

Tue Mar 16 03:06:06 1999  Hans-Peter Nilsson  <hp@bitrange.com>

	* htcommon/DocumentDB.cc (Delete): Fix bad parameter to Get: use
	key, not DocID.

Tue Mar 16 01:50:16 1999  Hans-Peter Nilsson  <hp@bitrange.com>

	* htlib/HtWordType.h (class HtWordType): New.
	* htlib/HtWordType.cc: New.
	* htlib/Makefile.in (OBJS): Add HtWordType.o

	* htdoc/attrs.html: Document attribute extra_word_characters.
	* htdoc/cf_byprog.html: Ditto.
	* htdoc/cf_byname.html: Ditto.

	* htcommon/defaults.cc (defaults): Add extra_word_characters.

	* htsearch/htsearch.h: Lose spurious extern declaration of unused
	variable valid_punctuation.
	* htsearch/htsearch.cc (main): Call HtWordType::Initialize.
	(setupWords): Use HtIsWordChar, HtIsStrictWordChar and
	HtStripPunctuation.  Do not read valid_punctuation.

	* htsearch/Display.cc (excerpt): Use HtIsStrictWordChar.

	* htlib/StringMatch.cc (FindFirstWord): Ditto.
	(CompareWord): Ditto.

	* htdig/htdig.cc (main): Call HtWordType::Initialize.

	* htdig/Retriever.h (class Retriever): Lose member
	valid_punctuation.
	* htdig/Retriever.cc (Retriever): Lose its initialization.

	* htdig/Postscript.h (class Postscript): Lose member
	valid_punctuation.
	* htdig/Postscript.cc (Postscript): Lose its initialization.
	(flush_word): Use HtStripPunctuation.
	(parse_string): Use HtIsWordChar,
	HtIsStrictWordChar and HtStripPunctuation.

	* htdig/Parsable.h (class Parsable): Lose member
	valid_punctuation.
	* htdig/Parsable.cc (Parsable): Lose its initilization.

	* htcommon/WordList.cc (valid_word): Use HtIsStrictWordChar.
	(BadWordFile): Use HtStripPunctuation.  Do not read
	valid_punctuation.

	* htcommon/DocumentRef.cc (AddDescription): Use HtIsWordChar,
	HtIsStrictWordChar and HtStripPunctuation.  Do not read
	valid_punctuation.

	* htdig/PDF.cc (parseString): Similar..

	* htdig/HTML.cc (parse): Similar.

	* htdig/Plaintext.cc (parse): Similar.

Sun Mar 14 14:04:31 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* htlib/Makefile.in: Add HtSGMLEntites.o to OBJS.

Sat Mar 13 21:29:38 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* htcommon/DocumentDB.cc(Open, Read): Switch to DB_HASH for faster
	access. Most important for very quick URL lookups!

	* htcommon/DocumentRef.cc(AddDescription): Check to see that
	description isn't a null string or contains only whitespace before
	doing anything.

	* htlib/HtSGMLCodec.h, htlib/HtSGMLCodec.cc: Add new class to
	convert between SGML entities and high-bit characters.

	* htdig/HTML.cc(parse): Use it instead of SGMLEntities.

	* htsearch/Display.cc(excerpt): Use HtSGMLCodec to covert *back*
	to SGML entities before displaying.

	* htlib/HtHeap.cc: Cleaned up comments, use more efficient
	procedure to build from a vector.
	
	* htlib/HtWordCodec.cc(HtWordCodec): Fix bug with constructing from
	uninitialized variables!

	* htlib/URL.h, htlib/URL.cc: Initial support for multiple schemes and
	user@host URLs.

	* htlib/List.cc(Nth): Check for out-of-bounds requests before
	doing anything.

Fri Mar 12 00:31:03 1999  Hans-Peter Nilsson  <hp@bitrange.com>

	* htlib/mktime.c (__mon_yday): Correct size to number of
	initializers (2).

	* htsearch/htsearch.cc (main): Remove doc_index handling.

	* htsearch/ResultMatch.h (setURL): Change to setID, use int.
	All callers changed.
	(getURL): Change to getID.
	All callers changed.
	(String url): Change to "int id".

	* htsearch/Display.h: (Display): Second parameter removed.
	(docIndex) removed.

	* htsearch/Display.cc (Display, ~Display): Do not handle
	docIndex.
	(display): Use DocumentDB::operator [](int), not
	DocumentDB::operator [] (char *).
	(buildMatchList): Changed to handle ResultMatch as DocID int,
	instead of URL string: use DocumentDB::operator [](int), not
	DocumentDB::operator [] (char *).  Get DocumentRef directly, then
	filter the URL by includeURL().

	* htnotify/htnotify.cc (main): Use DocIDs(), not DocURLs().
	Handle the change from String * to IntObject *.

	* htmerge/htmerge.cc (main): Do not delete doc_index.

	* htmerge/docs.cc (convertDocs): Test doc_index access as
	read-only.  Pass as parameter for docdb, do not handle separately.

	* htmerge/docs.cc (convertDocs): Add debug messages about cause
	when deleting documents.  If verbose > 1, write id/URL for every URL.

	* htmerge/db.cc (mergeDB): Handle doc_index, test accessibility.

	* htlib/IntObject.h (class IntObject): Add int-constructor.

	* htdoc/attrs.html (doc_index): Say that mapping is from document
	URLs to numbers.
	(doc_db): Say that indexing is on document number.

	* htdoc/cf_byprog.html (doc_index): Move from htsearch to htdig
	entry.

	* htdig/htdig.cc (main): Add .work suffix to doc_index too.
	Unlink doc_index if initial.

	* htcommon/DocumentDB.h (Open): New second argument.
	(Read): New second argument, default to 0.
	(operator [](int)): New.
	(Exists(char *), Delete(char *)): Change to int parameter.
	(DocIDs, i_dbf): New.

	* htcommon/DocumentDB.cc (operator [](int)): New.
	(Exists(char *), Delete(char *)): Changed to DocID int parameter.
	All callers changed.
	(URLs): Assume keys are ok without probing for documents
	with each key.
	(DocIDs): New.
	(Open): Take an index database file name as second argument.
	All callers changed.
	(Read): Similar, accept 0.
	(all): Change to index on DocID.

Wed Mar 10 02:25:24 1999  Hans-Peter Nilsson  <hp@bitrange.com>

	* htdoc/attrs.html (template_name): Typo; used by htsearch, not
	htdig.

Mon Mar  8 13:30:44 1999  Hans-Peter Nilsson  <hp@bitrange.com>

	* htdig/Retriever.cc (got_href): Check if the ref is for the
	current document before adding it to the db.

Sun Mar  7 20:50:37 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* htfuzzy/EndingsDB.cc(createDB): Use link and unlink to move,
	rather than a non-portable system call.

	* htcommon/DocumentRef.h, htcommon/DocumentRef.cc: Fix #ifdef
	problems with zlib.
	
Mon Mar  8 01:36:38 1999  Hans-Peter Nilsson  <hp@bitrange.com>

	* htlib/DB2_db.cc: Remove errno.
	* htlib/DB2_hash.cc: Ditto.

Sun Mar  7 09:39:37 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* htlib/timegm.c: Fix problems compiling on libc5 systems noted by
	Hans-Peter.

	* htlib/Makefile.in, Makefile.in, Makefile.config.in: Use regex.c
	instead of rx.

	* htfuzzy/EndingsDB.cc: Ditto.

	* configure.in, configure: Don't bother to config rx directory.
	
Fri Mar  5 08:09:20 1999  Gilles Detillieux  <grdetil@scrc.umanitoba.ca>

	* contrig/parse_doc.pl: uses pdftotext to handle PDF files,
	generates a head record with punctuation intact, extra checks
	for file "wrappers" & check for MS Word signature (no longer
	defaults to catdoc), strip extra punct. from start & end of words,
	rehyphenate text from PDFs.

Tue Mar  2 23:18:20 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* htdig/htdig.cc: Renamed main.cc for consistency with other programs.

	* htlib/DB2_hash.h, htlib/DB2_hash.cc: Added interface to Berkeley
	hash database format.

	* htlib/Makefile.in: Use them!
	
	* htlib/Database.h: Define database types, allowing a choice
	between different formats.

	* htlib/Database.cc(getDatabaseInstance): Use passed type to pick
	between subclasses. Currently only uses Hash and B-Tree formats of
	Berkeley DB.

	* htcommon/DocumentDB.cc, htfuzzy/Endings.cc,
	htfuzzy/EndingsDB.cc, htfuzzy/Fuzzy.cc, htfuzzy/Prefix.cc,
	htfuzzy/Substring.cc, htfuzzy/Synonym.cc, htfuzzy/htfuzzy.cc,
	htmerge/docs.cc, htmerge/words.cc, htsearch/Display.cc,
	htsearch/htsearch.cc: Use new form of getDatabaseInstance(),
	currently with DB_BTREE option (for compatibility).

Mon Mar  1 22:53:37 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* htlib/regex.c, htlib/striptime.c: Import new versions from
	glibc.

	* htlib/Makefile.in, htlib/mktime.c, htlib/timegm.c, htlib/lib.h:
	Changes to use glibc timegm() function instead of buggy mytimegm().
	
	* htdig/Document.cc(getdate): Use it.

Tue Mar  2 02:35:50 1999  Hans-Peter Nilsson  <hp@bitrange.com>

	* attrs.html: Rephrase and clarify entry for url_part_aliases.

Sun Feb 28 23:25:40 1999  Hans-Peter Nilsson  <hp@bitrange.com>

	* htlib/HtURLCodec.cc (~HtURLCodec): Add missing deletion of
	myWordCodec.

Fri Feb 26 19:03:58 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* configure, configure.in: Fix typo on timegm test.

	* htlib/mytimegm.cc: Fix Y2K problems.

Wed Feb 24 21:09:19 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* htsearch/htsearch.cc(main): Remember to delete the parser!

	* htlib/String.cc(String(char *s, int len)): Remove redundant copy.

	* htsearch/Display.cc(display): Free DocumentRef memory after
	displaying them.
	(displayMatch): Fix memory leak when documents did not have anchors.

Wed Feb 24 15:18:26 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* htlib/Configuration.cc(Add): Fix small leak in locale code.

	* htlib/String.cc: Fix up code to be cleaner with memory
	allocation, inline next_power_of_2.

Mon Feb 22 22:13:49 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* htlib/String.cc, htlib/htString.h: Fix some memory leaks.

Mon Feb 22 08:52:19 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* htlib/Dictionary.h, htlib/Dictionary.cc(hashCode): Check if key
	can be converted to an integer using strtol. If so, use the
	integer as the hash code.

	* htlib/HtVector.h, htlib/HtVector.cc: Implement Release() method
	and make sure delete calls are done properly.

	* htsearch/ResultList.h, htsearch/ResultList.cc(elements): Use HtVector
	instead of List.

	* htsearch/parser.cc: Ditto.
	
Sun Feb 21 16:13:59 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* htlib/HtHeap.h, htlib/HtHeap.cc: Add new class.

	* htlib/Makefile.in: Compile it.

	* htlib/HtVector.h, htlib/HtVector.cc: Add Assign() to assign to
	elements of vectors.

Sun Feb 21 14:45:26 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* htsearch/htsearch.cc: Add patch from Jerome Alet <alet@unice.fr>
	to allow '.' in config field but NOT './' for security reasons.

	* htdig/HTML.cc: Add patch from Gabriele to ensure META
	descriptions are parsed, even if 'description' is added to the
	keyword list.

Sun Feb 21 14:43:44 1999  Gilles Detillieux <grdetil@scrc.umanitoba.ca>

	* htsearch/parser.h, htsearch/parser.cc: Clean up patch made for
	error messages, made on Feb 16.

Thu Feb 18 20:19:30 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* htlib/HtVector.h, htlib/HtVector.cc: Added new Vector class.

	* htlib/Makefile.in: Compile it.

	* htlib/strptime.c: Add new version from glibc-2.1, replacing
	strptime.cc.

	* htdig/Document.cc: Use it.

	* htlib/regex.h, htlib/regex.c: Add new files from glibc-2.1.

	* htlib/mktime.c: Update from glibc-2.1.
	
Wed Feb 17 23:44:59 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* configure.in, configure, aclocal.m4: Add autoconf macro to
	detect syntax of makefile includes.
	
	* Makefile.in, Makefile.config.in, */Makefile.in: Change include
	syntax to use it.

Wed Feb 17 12:36:42 1999  Hans-Peter Nilsson  <hp@bitrange.com>

	* htcommon/defaults.cc (defaults): locale: change to "C".
