Sun Mar 21 15:19:00 1999  Hans-Peter Nilsson  <hp@bitrange.com>

	* htsearch/parser.cc (perform_push): Unpack WordRecords using
	htUnpack.
	* htsearch/htsearch.h: Add "debug" declaration.
	* htmerge/words.cc (mergeWords): Pack WordRecords using htPack.
	* htlib/Makefile.in (OBJS): Add HtPack.o
	* htcommon/WordRecord.h: Add WORD_RECORD_COMPRESSED_FORMAT

	* htdig/HTML.cc (parse): Keep contents in String variable
	textified_contents while using its "char *".

	* htsearch/Display.cc (excerpt): Similar for head_string.

Thu Mar 18 20:01:24 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* installdir/long.html, installdir/short.html: Write out HTML
	versions of the builtin templates.

	* installdir/htdig.conf: Add commented-out template_map and
	template_name attributes to use the on-disk versions.

Tue Mar 16 03:06:06 1999  Hans-Peter Nilsson  <hp@bitrange.com>

	* htcommon/DocumentDB.cc (Delete): Fix bad parameter to Get: use
	key, not DocID.

Tue Mar 16 01:50:16 1999  Hans-Peter Nilsson  <hp@bitrange.com>

	* htlib/HtWordType.h (class HtWordType): New.
	* htlib/HtWordType.cc: New.
	* htlib/Makefile.in (OBJS): Add HtWordType.o

	* htdoc/attrs.html: Document attribute extra_word_characters.
	* htdoc/cf_byprog.html: Ditto.
	* htdoc/cf_byname.html: Ditto.

	* htcommon/defaults.cc (defaults): Add extra_word_characters.

	* htsearch/htsearch.h: Lose spurious extern declaration of unused
	variable valid_punctuation.
	* htsearch/htsearch.cc (main): Call HtWordType::Initialize.
	(setupWords): Use HtIsWordChar, HtIsStrictWordChar and
	HtStripPunctuation.  Do not read valid_punctuation.

	* htsearch/Display.cc (excerpt): Use HtIsStrictWordChar.

	* htlib/StringMatch.cc (FindFirstWord): Ditto.
	(CompareWord): Ditto.

	* htdig/htdig.cc (main): Call HtWordType::Initialize.

	* htdig/Retriever.h (class Retriever): Lose member
	valid_punctuation.
	* htdig/Retriever.cc (Retriever): Lose its initialization.

	* htdig/Postscript.h (class Postscript): Lose member
	valid_punctuation.
	* htdig/Postscript.cc (Postscript): Lose its initialization.
	(flush_word): Use HtStripPunctuation.
	(parse_string): Use HtIsWordChar,
	HtIsStrictWordChar and HtStripPunctuation.

	* htdig/Parsable.h (class Parsable): Lose member
	valid_punctuation.
	* htdig/Parsable.cc (Parsable): Lose its initilization.

	* htcommon/WordList.cc (valid_word): Use HtIsStrictWordChar.
	(BadWordFile): Use HtStripPunctuation.  Do not read
	valid_punctuation.

	* htcommon/DocumentRef.cc (AddDescription): Use HtIsWordChar,
	HtIsStrictWordChar and HtStripPunctuation.  Do not read
	valid_punctuation.

	* htdig/PDF.cc (parseString): Similar..

	* htdig/HTML.cc (parse): Similar.

	* htdig/Plaintext.cc (parse): Similar.

Sun Mar 14 14:04:31 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* htlib/Makefile.in: Add HtSGMLEntites.o to OBJS.

Sat Mar 13 21:29:38 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* htcommon/DocumentDB.cc(Open, Read): Switch to DB_HASH for faster
	access. Most important for very quick URL lookups!

	* htcommon/DocumentRef.cc(AddDescription): Check to see that
	description isn't a null string or contains only whitespace before
	doing anything.

	* htlib/HtSGMLCodec.h, htlib/HtSGMLCodec.cc: Add new class to
	convert between SGML entities and high-bit characters.

	* htdig/HTML.cc(parse): Use it instead of SGMLEntities.

	* htsearch/Display.cc(excerpt): Use HtSGMLCodec to covert *back*
	to SGML entities before displaying.

	* htlib/HtHeap.cc: Cleaned up comments, use more efficient
	procedure to build from a vector.
	
	* htlib/HtWordCodec.cc(HtWordCodec): Fix bug with constructing from
	uninitialized variables!

	* htlib/URL.h, htlib/URL.cc: Initial support for multiple schemes and
	user@host URLs.

	* htlib/List.cc(Nth): Check for out-of-bounds requests before
	doing anything.

Fri Mar 12 00:31:03 1999  Hans-Peter Nilsson  <hp@bitrange.com>

	* htlib/mktime.c (__mon_yday): Correct size to number of
	initializers (2).

	* htsearch/htsearch.cc (main): Remove doc_index handling.

	* htsearch/ResultMatch.h (setURL): Change to setID, use int.
	All callers changed.
	(getURL): Change to getID.
	All callers changed.
	(String url): Change to "int id".

	* htsearch/Display.h: (Display): Second parameter removed.
	(docIndex) removed.

	* htsearch/Display.cc (Display, ~Display): Do not handle
	docIndex.
	(display): Use DocumentDB::operator [](int), not
	DocumentDB::operator [] (char *).
	(buildMatchList): Changed to handle ResultMatch as DocID int,
	instead of URL string: use DocumentDB::operator [](int), not
	DocumentDB::operator [] (char *).  Get DocumentRef directly, then
	filter the URL by includeURL().

	* htnotify/htnotify.cc (main): Use DocIDs(), not DocURLs().
	Handle the change from String * to IntObject *.

	* htmerge/htmerge.cc (main): Do not delete doc_index.

	* htmerge/docs.cc (convertDocs): Test doc_index access as
	read-only.  Pass as parameter for docdb, do not handle separately.

	* htmerge/docs.cc (convertDocs): Add debug messages about cause
	when deleting documents.  If verbose > 1, write id/URL for every URL.

	* htmerge/db.cc (mergeDB): Handle doc_index, test accessibility.

	* htlib/IntObject.h (class IntObject): Add int-constructor.

	* htdoc/attrs.html (doc_index): Say that mapping is from document
	URLs to numbers.
	(doc_db): Say that indexing is on document number.

	* htdoc/cf_byprog.html (doc_index): Move from htsearch to htdig
	entry.

	* htdig/htdig.cc (main): Add .work suffix to doc_index too.
	Unlink doc_index if initial.

	* htcommon/DocumentDB.h (Open): New second argument.
	(Read): New second argument, default to 0.
	(operator [](int)): New.
	(Exists(char *), Delete(char *)): Change to int parameter.
	(DocIDs, i_dbf): New.

	* htcommon/DocumentDB.cc (operator [](int)): New.
	(Exists(char *), Delete(char *)): Changed to DocID int parameter.
	All callers changed.
	(URLs): Assume keys are ok without probing for documents
	with each key.
	(DocIDs): New.
	(Open): Take an index database file name as second argument.
	All callers changed.
	(Read): Similar, accept 0.
	(all): Change to index on DocID.

Wed Mar 10 02:25:24 1999  Hans-Peter Nilsson  <hp@bitrange.com>

	* htdoc/attrs.html (template_name): Typo; used by htsearch, not
	htdig.

Mon Mar  8 13:30:44 1999  Hans-Peter Nilsson  <hp@bitrange.com>

	* htdig/Retriever.cc (got_href): Check if the ref is for the
	current document before adding it to the db.

Sun Mar  7 20:50:37 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* htfuzzy/EndingsDB.cc(createDB): Use link and unlink to move,
	rather than a non-portable system call.

	* htcommon/DocumentRef.h, htcommon/DocumentRef.cc: Fix #ifdef
	problems with zlib.
	
Mon Mar  8 01:36:38 1999  Hans-Peter Nilsson  <hp@bitrange.com>

	* htlib/DB2_db.cc: Remove errno.
	* htlib/DB2_hash.cc: Ditto.

Sun Mar  7 09:39:37 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* htlib/timegm.c: Fix problems compiling on libc5 systems noted by
	Hans-Peter.

	* htlib/Makefile.in, Makefile.in, Makefile.config.in: Use regex.c
	instead of rx.

	* htfuzzy/EndingsDB.cc: Ditto.

	* configure.in, configure: Don't bother to config rx directory.
	
Fri Mar  5 08:09:20 1999  Gilles Detillieux  <grdetil@scrc.umanitoba.ca>

	* contrig/parse_doc.pl: uses pdftotext to handle PDF files,
	generates a head record with punctuation intact, extra checks
	for file "wrappers" & check for MS Word signature (no longer
	defaults to catdoc), strip extra punct. from start & end of words,
	rehyphenate text from PDFs

Tue Mar  2 23:18:20 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* htdig/htdig.cc: Renamed main.cc for consistency with other programs.

	* htlib/DB2_hash.h, htlib/DB2_hash.cc: Added interface to Berkeley
	hash database format.

	* htlib/Makefile.in: Use them!
	
	* htlib/Database.h: Define database types, allowing a choice
	between different formats.

	* htlib/Database.cc(getDatabaseInstance): Use passed type to pick
	between subclasses. Currently only uses Hash and B-Tree formats of
	Berkeley DB.

	* htcommon/DocumentDB.cc, htfuzzy/Endings.cc,
	htfuzzy/EndingsDB.cc, htfuzzy/Fuzzy.cc, htfuzzy/Prefix.cc,
	htfuzzy/Substring.cc, htfuzzy/Synonym.cc, htfuzzy/htfuzzy.cc,
	htmerge/docs.cc, htmerge/words.cc, htsearch/Display.cc,
	htsearch/htsearch.cc: Use new form of getDatabaseInstance(),
	currently with DB_BTREE option (for compatibility).

Mon Mar  1 22:53:37 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* htlib/regex.c, htlib/striptime.c: Import new versions from
	glibc.

	* htlib/Makefile.in, htlib/mktime.c, htlib/timegm.c, htlib/lib.h:
	Changes to use glibc timegm() function instead of buggy mytimegm().
	
	* htdig/Document.cc(getdate): Use it.

Tue Mar  2 02:35:50 1999  Hans-Peter Nilsson  <hp@bitrange.com>

	* attrs.html: Rephrase and clarify entry for url_part_aliases.

Sun Feb 28 23:25:40 1999  Hans-Peter Nilsson  <hp@bitrange.com>

	* htlib/HtURLCodec.cc (~HtURLCodec): Add missing deletion of
	myWordCodec.

Fri Feb 26 19:03:58 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* configure, configure.in: Fix typo on timegm test.

	* htlib/mytimegm.cc: Fix Y2K problems.

Wed Feb 24 21:09:19 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* htsearch/htsearch.cc(main): Remember to delete the parser!

	* htlib/String.cc(String(char *s, int len)): Remove redundant copy.

	* htsearch/Display.cc(display): Free DocumentRef memory after
	displaying them.
	(displayMatch): Fix memory leak when documents did not have anchors.

Wed Feb 24 15:18:26 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* htlib/Configuration.cc(Add): Fix small leak in locale code.

	* htlib/String.cc: Fix up code to be cleaner with memory
	allocation, inline next_power_of_2.

Mon Feb 22 22:13:49 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* htlib/String.cc, htlib/htString.h: Fix some memory leaks.

Mon Feb 22 08:52:19 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* htlib/Dictionary.h, htlib/Dictionary.cc(hashCode): Check if key
	can be converted to an integer using strtol. If so, use the
	integer as the hash code.

	* htlib/HtVector.h, htlib/HtVector.cc: Implement Release() method
	and make sure delete calls are done properly.

	* htsearch/ResultList.h, htsearch/ResultList.cc(elements): Use HtVector
	instead of List.

	* htsearch/parser.cc: Ditto.
	
Sun Feb 21 16:13:59 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* htlib/HtHeap.h, htlib/HtHeap.cc: Add new class.

	* htlib/Makefile.in: Compile it.

	* htlib/HtVector.h, htlib/HtVector.cc: Add Assign() to assign to
	elements of vectors.

Sun Feb 21 14:45:26 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* htsearch/htsearch.cc: Add patch from Jerome Alet <alet@unice.fr>
	to allow '.' in config field but NOT './' for security reasons.

	* htdig/HTML.cc: Add patch from Gabriele to ensure META
	descriptions are parsed, even if 'description' is added to the
	keyword list.

Sun Feb 21 14:43:44 1999  Gilles Detillieux <grdetil@scrc.umanitoba.ca>

	* htsearch/parser.h, htsearch/parser.cc: Clean up patch made for
	error messages, made on Feb 16.

Thu Feb 18 20:19:30 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* htlib/HtVector.h, htlib/HtVector.cc: Added new Vector class.

	* htlib/Makefile.in: Compile it.

	* htlib/strptime.c: Add new version from glibc-2.1, replacing
	strptime.cc.

	* htdig/Document.cc: Use it.

	* htlib/regex.h, htlib/regex.c: Add new files from glibc-2.1.

	* htlib/mktime.c: Update from glibc-2.1.
	
Wed Feb 17 23:44:59 1999  Geoff Hutchison  <ghutchis@wso.williams.edu>

	* configure.in, configure, aclocal.m4: Add autoconf macro to
	detect syntax of makefile includes.
	
	* Makefile.in, Makefile.config.in, */Makefile.in: Change include
	syntax to use it.

Wed Feb 17 12:36:42 1999  Hans-Peter Nilsson  <hp@bitrange.com>

	* htcommon/defaults.cc (defaults): locale: change to "C".
